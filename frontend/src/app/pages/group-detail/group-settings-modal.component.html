<div class="modal-overlay">
  <div class="modal card" (click)="$event.stopPropagation()">
    <div class="modal__header">
      <h2>Group Settings</h2>
      <button class="modal__close" (click)="close.emit()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    @if (groupSettingsError) {
      <div class="alert alert--danger">{{ groupSettingsError }}</div>
    }

    <form (ngSubmit)="submit.emit()">
      <div class="form-group">
        <label>Group image</label>
        @if (groupImageError) {
          <div class="alert alert--danger">{{ groupImageError }}</div>
        }
        <div class="image-upload">
          <img
            class="image-upload__preview"
            [src]="groupImagePreview || group.imageUrl || defaultGroupImage"
            [alt]="group.name"
          />
          <input
            type="file"
            accept="image/png,image/jpeg,image/webp"
            (change)="groupImageSelected.emit($event)"
            [disabled]="groupImageUploading"
          />
          <button
            type="button"
            class="btn btn--outline"
            (click)="uploadGroupImage.emit()"
            [disabled]="groupImageUploading"
          >
            @if (groupImageUploading) { Uploading... } @else { Upload Image }
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="editHistoryRetention">History retention</label>
        <select
          id="editHistoryRetention"
          class="form-control"
          [ngModel]="editHistoryRetentionDays"
          (ngModelChange)="editHistoryRetentionDaysChange.emit($event)"
          name="editHistoryRetentionDays"
          [disabled]="groupSettingsLoading"
        >
          <option [ngValue]="7">1 week</option>
          <option [ngValue]="30">1 month</option>
          <option [ngValue]="365">1 year</option>
        </select>
        <small class="form-hint">Older games and system events are hidden from the history view.</small>
      </div>

      <div class="form-group">
        <label>Delete group</label>
        <div class="danger-actions">
          <button type="button" class="btn btn--danger btn--confirm-action" (click)="requestDeleteGroup.emit()" title="Delete group"
                  [disabled]="deleteGroupLoading || confirmModalLoading">
            <i class="fas fa-trash"></i> Delete Group
          </button>
        </div>
        <small class="form-hint">This action permanently deletes the group and all related data.</small>
      </div>

      <div class="modal__actions">
        <button type="button" class="btn btn--outline" (click)="close.emit()" [disabled]="groupSettingsLoading">
          Cancel
        </button>
        <button type="submit" class="btn btn--primary" [disabled]="groupSettingsLoading">
          @if (groupSettingsLoading) { Saving... } @else { Save Changes }
        </button>
      </div>
    </form>
  </div>
</div>
