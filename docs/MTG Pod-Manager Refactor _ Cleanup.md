# MTG Pod-Manager Refactor / Cleanup

Hier ist eine konkrete, priorisierte Liste, was in deinem Code jetzt sinnvoll möglich ist.  
Top-Priorität (hoher Nutzen, wenig Risiko)

1. Backend-Strictness schrittweise aktivieren (strictNullChecks, noImplicitAny, etc. sind aus) in [tsconfig.json (line 15\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
2. Test-Baseline einführen: Backend hat aktuell praktisch keine Tests; Frontend nur [app.spec.ts (line 4\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
3. group-detail aufteilen (sehr groß: TS/HTML/SCSS) aus [group-detail.component.ts (line 1\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
4. any eliminieren an Kernstellen, z.B. [games.service.ts (line 466\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) und [auth.service.ts (line 98\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
5. Duplizierte Business-Logik für Rank/Ties zentralisieren (Frontend \+ Backend) in [group-detail.component.ts (line 201\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) und [games.service.ts (line 486\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).

Architektur-Refactors

1. Wiederholte Membership-/Role-Checks in Guard/Helper kapseln (decks/games/groups), z.B. [decks.service.ts (line 119\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
2. ApiService im Frontend in Domain-Services splitten (Groups/Decks/Games/Admin) statt Monolith in [api.service.ts (line 1\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
3. Archidekt-Integration aus DecksService in eigenen Adapter/Provider ziehen ([decks.service.ts (line 20\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#)).  
4. Logging vereinheitlichen: [console.\*](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) durch Nest Logger \+ Frontend Error-Handling-Service ersetzen, z.B. [decks.service.ts (line 56\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).

Code-Qualität / Clean Code

1. ValidationPipe härten (forbidNonWhitelisted, transform) in [main.ts (line 15\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
2. Einheitliche Sprache für Messages (aktuell gemischt DE/EN) für bessere Wartbarkeit.  
3. Potenziell obsoletes Admin-Tool prüfen: archidekt-test Route/Seite in [app.routes.ts (line 47\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
4. Kleine Performance-Optimierungen: in games.service wiederholte find in Loops durch Maps ersetzen ([games.service.ts (line 93\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#)).

Kommentar-Strategie (für Mensch \+ AI)

1. Keine “Line-by-line”-Kommentare, sondern kurze Intent-Kommentare an komplexen Stellen.  
2. JSDoc für Business-Regeln/Formeln (Punkteberechnung, Tie-Regeln, Season-Reset), z.B. [games.service.ts (line 392\)](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#).  
3. Pro Modul ein kurzes [README.md](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (Responsibilities, Inputs/Outputs, wichtige Invarianten).  
4. “Warum”-Kommentare bei nicht offensichtlichen Tradeoffs (z.B. Archidekt-Fallbacks, Chart-Workarounds).

Ich habe [MTG Pod-Manager Refactor \_ Cleanup.md](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) gelesen und den aktuellen Stand im Repo geprüft (Stand: 10\. Februar 2026). Kurzstatus: Backend‑Strictness ist aktiv in [tsconfig.json](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), die ValidationPipe ist gehärtet in [main.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), ApiService wurde bereits in mehrere Domain‑Services gesplittet in frontend/src/app/core/services, any‑Typen sind nicht mehr in den Kernstellen sichtbar, und die Map‑Optimierung in [games.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) ist umgesetzt. Offen bleiben die Punkte unten.

Offene Schritte (präzise, KI‑lesbar)

1. TODO‑01 Backend‑Testbasis aufbauen. Ziel: belastbare Unit‑Tests im Backend. Scope: [package.json](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), backend/src/\*\*. Schritte: Test‑Runner und Nest‑Testing‑Setup definieren; Test‑Hilfen (Prisma‑Mocks oder Test‑DB) festlegen; erste Tests für Kernservices erstellen (mindestens [games.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [groups.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [decks.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [auth.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#)). Fertig wenn: es gibt ein wiederholbar ausführbares Test‑Script und die genannten Kernservices haben echte Unit‑Tests.  
2. TODO‑02 Frontend‑Testabdeckung erweitern. Ziel: Unit‑Tests über die aktuellen Group‑Detail‑Utils hinaus. Scope: frontend/src/app/pages/\*\*, frontend/src/app/core/services/\*\*. Schritte: Teststrategie für Komponenten und Services definieren; Tests für [group-play.component.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [groups.component.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) und die API‑Services ([\*-api.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#)) ergänzen; kritische Logikpfade der UI abdecken. Fertig wenn: Unit‑Tests existieren für die genannten Bereiche und lassen sich konsistent ausführen.  
3. TODO‑03 Group‑Detail weiter aufsplitten. Ziel: group-detail aus der Monolith‑Komponente herausbrechen. Scope: [group-detail.component.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (1705 Zeilen), [...html](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (1113 Zeilen), [...scss](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (1276 Zeilen). Schritte: UI‑Sektionen in klar abgegrenzte Child‑Components aufteilen (Ranking, History, Stats, Deck‑Liste, Member‑Management, Applications, Modals); Container‑Komponente auf Orchestrierung reduzieren; Styling pro Child‑Component isolieren. Fertig wenn: die drei großen Dateien sind deutlich kleiner und die Hauptkomponente enthält primär State‑Management und Routing.  
4. TODO‑04 Group‑Play aufsplitten. Ziel: group-play in kleinere UI‑Module teilen. Scope: [group-play.component.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (591 Zeilen), [...html](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (470 Zeilen), [...scss](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (779 Zeilen). Schritte: wiederverwendbare UI‑Blöcke (Spieler‑Eintrag, Deck‑Auswahl, Such‑Dropdown, Ergebnisübersicht) in eigene Komponenten verschieben; Logik pro Block isolieren. Fertig wenn: group-play kein Monolith mehr ist und die Komponenten klar benannte Verantwortlichkeiten haben.  
5. TODO‑05 Große Backend‑Services modularisieren. Ziel: Services mit hoher Komplexität aufteilen. Scope: [groups.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (867 Zeilen), [games.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (468 Zeilen), [decks.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (380 Zeilen). Schritte: Fachbereiche als Sub‑Services extrahieren (z.B. Membership/Invites/Season in Groups; Ranking/Points in Games; Archidekt‑Integration in Decks); konsistente Schnittstellen definieren; DI sauber halten. Fertig wenn: zentrale Services werden deutlich kleiner und die Fachlogik ist in eigenen Klassen kapselt.  
6. TODO‑06 Membership‑/Role‑Checks zentralisieren. Ziel: keine duplizierten Rollenprüfungen in Services. Scope: [games.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [groups.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [decks.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#). Schritte: gemeinsames Guard/Helper‑Modul definieren; alle direkten Role‑Checks auf den Helper umstellen; Fehlermeldungen vereinheitlichen. Fertig wenn: Rollenprüfung und Membership‑Verifikation nur an einer Stelle implementiert sind. **DONE 2026-02-10 (GroupsMembershipService genutzt in Games/Decks/Groups).**  
7. TODO‑07 Rank/Tie‑Logik als Single Source of Truth definieren. Ziel: Frontend und Backend folgen exakt denselben Regeln. Scope: [games.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [rank-utils.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#). Schritte: formale Regel‑Definition (Dokumentation) festlegen; Backend‑Implementierung in eine dedizierte Utility/Service auslagern; Frontend‑Utils an diese Regeln angleichen; Tests für Ties/Bounds in beiden Schichten. Fertig wenn: ein Testset beweist identische Ergebnisse in FE und BE. **DONE 2026-02-10 (FE/BE Validierungslogik angeglichen, Tests erweitert).**  
8. TODO‑08 Archidekt‑Integration aus DecksService herauslösen. Ziel: Adapter/Provider statt Logik im Service. Scope: [decks.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), backend/src/archidekt/\*\*. Schritte: Fetch/Parse‑Logik in Archidekt‑Provider verschieben; DecksService nur noch Adapter‑Aufruf; Fehlerfälle standardisieren; Unit‑Tests ergänzen. Fertig wenn: DecksService keine HTTP‑Details mehr kennt. **DONE 2026-02-10 (DecksArchidektService eingeführt, DecksService delegiert).**  
9. TODO‑09 Logging und Error‑Handling vereinheitlichen. Ziel: keine [console.\*](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) und konsistente Fehlerbehandlung. Scope: [main.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), [archidekt-test.component.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), plus FE‑Core. Schritte: Frontend‑Error‑Handling‑Service bzw. globaler ErrorHandler einführen; console.error ersetzen; Logging‑Levels dokumentieren; optional zentralen Logger im Backend konsequent nutzen. Fertig wenn: [console.\*](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) entfernt ist und Errors zentral landen. **DONE 2026-02-10 (FE ErrorReportingService + GlobalErrorHandler, console.* entfernt).**  
10. TODO‑10 Sprache der Messages vereinheitlichen. Ziel: alle user‑facing Messages in einer Sprache. Scope: Backend Exceptions (z.B. [groups.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#)) und Frontend‑UI‑Texte. Schritte: Ziel‑Sprache festlegen; systematischer Sweep aller Messages; Tests/Checks für Konsistenz definieren. Fertig wenn: keine gemischten DE/EN‑Messages mehr vorhanden sind. **DONE 2026-02-10 (alles auf Englisch vereinheitlicht).**  
11. TODO‑11 Kommentier‑ und Doku‑Strategie umsetzen. Ziel: wartbare, erklärende Dokumentation. Scope: [games.service.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#) (Business‑Regeln), Module‑Readmes in backend/src/\*\* und frontend/src/\*\*. Schritte: JSDoc für Regeln (Punkte/Ties/Season‑Reset) hinzufügen; pro Modul ein kurzes README mit Responsibilities, Inputs/Outputs und Invarianten erstellen; “Warum”‑Kommentare an nicht offensichtlichen Entscheidungen ergänzen. Fertig wenn: Business‑Regeln nachvollziehbar dokumentiert sind. **DONE 2026-02-10 (JSDoc + Why-Comments hinzugefuegt, Module-Readmes erstellt).**  
12. TODO‑12 Archidekt‑Test‑Tool entscheiden. Ziel: unnötige Admin‑Tools entfernen oder sauber einschränken. Scope: [app.routes.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#), frontend/src/app/pages/archidekt-test/\*, [groups.component.ts](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/Michi/.vscode/extensions/openai.chatgpt-0.4.71-win32-x64/webview/#). Schritte: Klären ob das Tool produktiv gebraucht wird; falls nein: Route/Navigation entfernen; falls ja: Zugriff beschränken und Logging sauber integrieren. Fertig wenn: es existiert eine klare Entscheidung inkl. Umsetzung. **DONE 2026-02-10 (Route und Backend-Endpunkt auf Sysadmin beschraenkt).**  
13. TODO‑13 README pro Hauptkomponente. Ziel: schnelle Orientierung für Entwickler + KI. Scope: jede Hauptkomponente/Seite (z.B. group-detail, group-play, groups, auth, decks, games) sowie zentrale Services. Schritte: pro Komponente eine kurze README mit Responsibilities, wichtigsten Inputs/Outputs, Datenflüssen, Invarianten und bekannten Fallstricken. Fertig wenn: alle Hauptkomponenten eine README im jeweiligen Ordner haben. **DONE 2026-02-10 (README-Dateien pro Hauptkomponente und zentrale Services erstellt).**
